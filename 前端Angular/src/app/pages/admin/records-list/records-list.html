<h2>購買紀錄管理</h2>

<!-- 新增紀錄 -->
<div class="add-record-form">
  <input [(ngModel)]="newRecord.client_id" type="number" placeholder="客戶 ID" />
  <input [(ngModel)]="newRecord.product_id" type="number" placeholder="產品 ID" />
  <input [(ngModel)]="newRecord.quantity" type="number" placeholder="數量" />
  <input [(ngModel)]="newRecord.amount" type="number" placeholder="總金額" />
  <input [(ngModel)]="newRecord.order_date" type="date" placeholder="訂單日期" />
  <button (click)="addRecord()">新增紀錄</button>
</div>

<!-- 紀錄清單 -->
<table class="record-table">
  <thead>
    <tr>
      <th>客戶 ID</th>
      <th>產品 ID</th>
      <th>數量</th>
      <th>金額</th>
      <th>訂單日期</th>
      <th>建立時間</th>
      <th>更新時間</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let r of records$ | async">
      <!-- 編輯模式 -->
      <ng-container *ngIf="editMode === r.id && editRecord; else viewMode">
        <td><input [(ngModel)]="editRecord.client_id" type="number" /></td>
        <td><input [(ngModel)]="editRecord.product_id" type="number" /></td>
        <td><input [(ngModel)]="editRecord.quantity" type="number" /></td>
        <td><input [(ngModel)]="editRecord.amount" type="number" /></td>
        <td>
          <input
            [(ngModel)]="editRecord.order_date"
            type="date"
          />
        </td>
        <td>
          {{ editRecord.created_at?.seconds * 1000 | date: "yyyy/MM/dd HH:mm" }}
        </td>
        <td>
          {{ editRecord.updated_at?.seconds * 1000 | date: "yyyy/MM/dd HH:mm" }}
        </td>
        <td>
          <button (click)="updateRecord()">儲存</button>
          <button (click)="cancelEdit()">取消</button>
        </td>
      </ng-container>

      <!-- 檢視模式 -->
      <ng-template #viewMode>
        <td>{{ r.client_id }}</td>
        <td>{{ r.product_id }}</td>
        <td>{{ r.quantity }}</td>
        <td>{{ r.amount | currency: "TWD" }}</td>
        <td>{{ r.order_date?.seconds * 1000 | date: "yyyy/MM/dd" }}</td>
        <td>{{ r.created_at?.seconds * 1000 | date: "yyyy/MM/dd HH:mm" }}</td>
        <td>{{ r.updated_at?.seconds * 1000 | date: "yyyy/MM/dd HH:mm" }}</td>
        <td>
          <button (click)="startEdit(r)">編輯</button>
          <button (click)="deleteRecord(r.id!)">刪除</button>
        </td>
      </ng-template>
    </tr>
  </tbody>
</table>
