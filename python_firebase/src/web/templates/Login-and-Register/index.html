<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <title>登入 / 註冊</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 共用字型 & 樣式 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <style>
    *,
    :before,
    :after {
      box-sizing: border-box
    }

    body {
      -webkit-font-smoothing: antialiased;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: #fffefc
    }

    input,
    button {
      font: inherit;
      background-color: inherit;
      border: none;
      outline: none
    }

    a {
      text-decoration: none;
      color: inherit;
      cursor: pointer
    }

    .hidden {
      display: none
    }

    #container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh
    }

    .card {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
      width: 800px;
      max-width: 95%;
      overflow: hidden;
      display: flex
    }

    .left {
      flex: 1;
      background: url('https://blondy-u5tkmwzehu.figweb.site/cdn-cgi/imagedelivery/s-dfVpmPR-aKHmwFNwAgnQ/blondy-u5tkmwzehu.figweb.site-cf2becd02e34be41727b137115ae2492e1393d1b/public') center/cover;
      border-radius: 20px 0 0 20px
    }

    .right {
      flex: 1;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center
    }

    h2 {
      margin-bottom: 20px;
      text-align: center
    }

    .form-group {
      margin-bottom: 20px
    }

    .form-group input {
      width: 100%;
      padding: 12px 20px;
      border: 1px solid #49bbbd;
      border-radius: 30px
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      text-align: center;
      background: #49bbbd;
      color: #fff;
      border-radius: 30px;
      font-weight: 500;
      cursor: pointer
    }

    .switch {
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      color: #555
    }

    .google-login {
      margin-top: 20px;
      text-align: center
    }

    .google-login h3 {
      margin-bottom: 10px;
      font-size: 16px
    }
  </style>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";


    const firebaseConfig = {
      apiKey: "AIzaSyBjLqdQQidCg0m7gI9-CQ22riQsiASr5_U",
      authDomain: "project-6578679306365113348.firebaseapp.com",
      projectId: "project-6578679306365113348",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // 顯示提示
    function showToast(msg) { alert(msg); }

    // ===== 登入 =====
    async function handleLogin(e) {
      e.preventDefault();
      const email = e.target.email.value;
      const password = e.target.password.value;
      try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const idToken = await userCred.user.getIdToken();
        const res = await fetch("/api/users/login", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id_token: idToken })
        });
        const data = await res.json();
        if (data.ok) { showToast("登入成功"); setTimeout(() => window.location.href = "/Naitre-Beauty/", 800); }
        else { showToast(data.message); }
      } catch (err) { showToast("登入失敗：" + err.message); }
    }

    // ===== 註冊 =====
    async function handleRegister(e) {
      e.preventDefault();
      const email = e.target.email.value;
      const password = e.target.password.value;
      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        const idToken = await userCred.user.getIdToken();
        const res = await fetch("/api/users/login", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id_token: idToken })
        });
        const data = await res.json();
        if (data.ok) { showToast("註冊成功"); setTimeout(() => window.location.href = "/Naitre-Beauty/", 800); }
        else { showToast(data.message); }
      } catch (err) { showToast("註冊失敗：" + err.message); }
    }

    // ===== Google 登入 =====
    async function handleGoogleLogin() {
      try {
        const result = await signInWithPopup(auth, provider);
        const idToken = await result.user.getIdToken();
        const res = await fetch("/api/users/login", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id_token: idToken })
        });
        const data = await res.json();
        if (data.ok) { showToast("Google 登入成功"); setTimeout(() => window.location.href = "/Naitre-Beauty/", 800); }
        else { showToast(data.message); }
      } catch (err) { showToast("Google 登入失敗：" + err.message); }
    }

    window.handleLogin = handleLogin;
    window.handleRegister = handleRegister;
    window.handleGoogleLogin = handleGoogleLogin;
    window.toggleForm = function (type) {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("register-section").classList.add("hidden");
      if (type === "login") { document.getElementById("login-section").classList.remove("hidden"); }
      else { document.getElementById("register-section").classList.remove("hidden"); }
    }
  </script>
</head>

<body>
  <div id="container">
    <div class="card">
      <div class="left"></div>
      <div class="right">
        <!-- 登入 -->
        <div id="login-section">
          <h2>登入</h2>
          <form onsubmit="handleLogin(event)">
            <div class="form-group"><input type="email" name="email" placeholder="Email" required></div>
            <div class="form-group"><input type="password" name="password" placeholder="密碼" required></div>
            <button type="submit" class="btn">登入</button>
          </form>
          <div class="switch">還沒有帳號？<a onclick="toggleForm('register')">立即註冊</a></div>
          <div class="google-login">

            <button onclick="handleGoogleLogin()" class="btn"
              style="background:#fff;color:#000;border:1px solid #ccc">Google 登入</button>
          </div>
        </div>

        <!-- 註冊 -->
        <div id="register-section" class="hidden">
          <h2>註冊</h2>
          <form onsubmit="handleRegister(event)">
            <div class="form-group"><input type="text" name="name" placeholder="姓名" required></div>
            <div class="form-group"><input type="email" name="email" placeholder="Email" required></div>
            <div class="form-group"><input type="password" name="password" placeholder="密碼" required></div>
            <button type="submit" class="btn">註冊</button>
          </form>
          <div class="switch">已有帳號？<a onclick="toggleForm('login')">立即登入</a></div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>